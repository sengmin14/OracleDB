# 🥕트랜잭션 격리 수준

## 트랜잭션 격리수준이란
- 동시에 여러 트랜잭션이 처리될 때, 트랜잭션끼리 얼마나 고립(격리)되어 있는가에 대한 수준을 말한다.

```
트랜잭션의 성질 중 격리성(Isolation)이 있다.
격리성이란 트랜잭션 수행 시 다른 트랜잭션이 끼어들지 못하도록 보장하는 것을 말한다.
이는 "트랜잭션은 서로 완전히 격리되어 있으니 다른 트랜잭션이 끼어들지 못한다."가 아니다.
격리성을 강화시킨다면 다른 트랜잭션이 끼어들지 못하게 보장할 수 있고,
약화시킨다면 다른 트랜잭션도 중간에 끼어들 수 있다는 의미이다.
```

## 트랜잭션 ACID
### Atomicity (원자성)
- 한 트랜잭션의 연산은 모두 성공하거나, 모두 실패해야한다.
- 예를들어 돈을 이체할 때 보내는 쪽에서 돈을 빼오는 작업만 성공하고, 받는 쪽은 돈을 넣는 작업은 실패하면 안된다.

### Consistency (일관성, 정합성)
- 트랜잭선 처리 후에도 데이터의 상태는 일관되어야 한다.
- 만약, constraints, trigger 등을 통해서 DB에 정의된 규칙을 트랜잭션이 위반했다면 롤백해야 한다.
- 예를 들어, 계좌에 잔액을 업데이트하는 트랜잭션 결과로 잔액이 마이너스로 가버렸다면 그냥 롤백해야 한다.

### Isolation (고립성)
- 트랜잭션 수행 시 다른 트랜잭션의 연산이 끼어들지 못하도록 보장한다.
- 하나의 트랜잭션이 다른 트랜잭션에게 영향을 주지 않도록 격리되어 수행되어야한다.
- DBMS는 여러 종류의 Isolation level을 제공하고, 개발자는 이중에서 어떤 레벨로 트랜잭션을 컨트롤할지 설정할 수 있다.

### Durability (영속성)
- 커밋된 트랜잭션의 결과는 데이터베이스에 영구적으로 저장되어야 한다.
- 영구적 저장 == 비휘발성 메모리(HDD, SSD 등)에 저장
- 중간에 DB에 오류가 발생하면 다시 복구되어야 한다.

## 트랜잭션 격리수준 단계
- 트랜잭션 격리수준은 총 4단계로 Uncommitted Read, Committed Read, Repeatable Read, Serializable로 구성된다.
### Uncommitted Read (커밋되지 않은 읽기)
- 다른 트랜잭션에서 커밋되지 않은 데이터에 접근할 수 있게 하는 격리 수준이다.
- 가장 저수준의 격리수준이며, 일반적으로 사용하지 않는 격리수준이다.
- 10번 트랜잭션이 '박기영'이라는 데이터를 '박경'으로 UPDATE 한 후 Commit 하지 않았을 때 13번 트랜잭션에서 접근하여 커밋되지 않은 데이터를 읽을 수 있다.
- 13번 트랜잭선이 데이터를 읽은 후 10번 트랜잭션에 문제가 발생하여 롤백된다면 데이터 부정합을 발생시킬 수 있다.
- 오라클에서는 이 수준을 지원하지 않는다.
- 커밋되지 않는 트랜잭션에 접근하여 부정합을 유발할 수 있는 데이터를 읽는 것을 더티읽기(Dirty Read)라고 한다.

<img width="829" height="693" alt="image" src="https://github.com/user-attachments/assets/cdd1461c-f89d-458b-9ce1-0db8e4861616" />


### Committed Read (커밋된 읽기)
- 다른 트랜잭션에서 커밋된 데이터로만 접근할 수 있게 하는 격리 수준이다.
- MySQL을 제외하고 대부분 이를 기본 격리수준으로 사용한다.
- 10번 트랜잭션이 '박기영'이라는 데이터를 '박경'으로 UPDATE 한 후 Commit 하지 않았을 때, 13번 트랜잭션에서 이를 조회할 경우 UPDATE 전 데이터인 '박기연'이라는 값이 조회된다.
- Dirty Read 현상은 발생하지 않는다.

<img width="726" height="564" alt="image" src="https://github.com/user-attachments/assets/d55d25d7-e5b5-4f45-abde-31b9c04f4e54" />


#### ※ Undo 영역
```
영속성 : 중간에 DB에 오류가 발생하면 다시 복구되어야 한다.
```
- 트랜잭션에 대한 로그가 반드시 남아있어야 한다.
- 즉, 복구는 로그를 기반으로 처리된다.
- 이 로그는 크게 두 가지가 있다. (오류에 의한 복구에 사용되는 Redo Log, 트랜잭션 롤백을 위해 사용되는 Undo Log)
- 












